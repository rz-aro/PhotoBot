<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/macy@2"></script>
<style>
        div {
            display: flex;
            justify-content: center;
        }

        /* Responsive styles */
        #macy-container {
            max-width: 1200px;
            margin: auto;
        }

        .macy-item > img {
            /* width is 15% for screen width */
            width: 15vw;
            height: auto;
            margin-bottom: 24px;
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid #eee;
        }

        .macy-item > img {
            transition: transform 0.3s cubic-bezier(.25,.8,.25,1), box-shadow 0.3s;
            cursor: pointer;
        }

        .macy-item > img:hover {
            transform: scale(1.5);
            z-index: 2;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            position: relative;
        }

    </style>
</head>

<body style="overflow-x: hidden;">
    <!-- Loader -->
    <div id="loader" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgb(0, 0, 0); display: flex; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.6s;">
        <span style="color: #fff; font-size: 2rem;">Loading...</span>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const loader = document.getElementById('loader');
            const images = document.querySelectorAll('#macy-container img');
            let loadedCount = 0;
            function hideLoader() {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 600);
            }
            if (images.length === 0) {
                hideLoader();
            }
            images.forEach(img => {
                if (img.complete) {
                    loadedCount++;
                    if (loadedCount === images.length) hideLoader();
                } else {
                    img.addEventListener('load', () => {
                        loadedCount++;
                        if (loadedCount === images.length) hideLoader();
                    });
                    img.addEventListener('error', () => {
                        loadedCount++;
                        if (loadedCount === images.length) hideLoader();
                    });
                }
            });
        });
    </script>
    <div id="macy-container">
        {% for image in images %}
        <div class="macy-item">
            <img src="pics/{{ image[0] }}" alt="Image" data-caption="{{ image[1] }}" data-user="{{ image[2] }}">
        </div>
        {% endfor %}

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const macyInstance = Macy({
                container: '#macy-container',
                trueOrder: false,
                waitForImages: false,
                margin: 15,
                columns: 5,
                breakAt: {
                    1200: {
                        margin: 10,
                        columns: 5
                    },
                    800: {
                        margin: 5,
                        columns: 5
                    },
                }

            });

            const images = document.querySelectorAll('img');
            images.forEach(img => {
                img.addEventListener('click', function() {
                    const src = this.getAttribute('src');
                    const rect = this.getBoundingClientRect();

                    // Create modal overlay
                    const modal = document.createElement('div');
                    modal.style.position = 'fixed';
                    modal.style.top = '0';
                    modal.style.left = '0';
                    modal.style.width = '100%';
                    modal.style.height = '100%';
                    modal.style.backgroundColor = 'rgba(0, 0, 0, 0)';
                    modal.style.display = 'flex';
                    modal.style.justifyContent = 'center';
                    modal.style.alignItems = 'center';
                    modal.style.transition = 'background-color 0.4s cubic-bezier(.25,.8,.25,1)';
                    modal.style.zIndex = '99999';

                    // Create animated image
                    const modalImg = document.createElement('img');
                    modalImg.src = src;
                    modalImg.style.position = 'fixed';
                    modalImg.style.left = rect.left + 'px';
                    modalImg.style.top = rect.top + 'px';
                    modalImg.style.width = rect.width + 'px';
                    modalImg.style.height = rect.height + 'px';
                    modalImg.style.margin = '0';
                    modalImg.style.borderRadius = '4px';
                    modalImg.style.boxShadow = '0 8px 32px rgba(0,0,0,0.25)';
                    modalImg.style.transition = 'all 0.4s cubic-bezier(.25,.8,.25,1)';
                    modalImg.style.zIndex = '100000';

                    // create caption
                    const caption = document.createElement('div');
                    caption.style.position = 'absolute';
                    caption.style.bottom = '10%';
                    caption.style.left = '50%';
                    caption.style.transform = 'translateX(-50%)';
                    caption.style.color = '#eee';
                    caption.style.fontSize = '1.2rem';
                    caption.style.textAlign = 'center';
                    // replace all emojis in the format :name: with empty string. also replace * and "
                    caption_text = this.getAttribute('data-caption').replace(/:[a-zA-Z0-9_]+:/g, '').replace(/\*/g, '').replace(/"/g, '');
                    caption.innerHTML = caption_text + "<br> - " + this.getAttribute('data-user')|| 'No caption available';
                    console.log(this.getAttribute('data-caption'));
                    modal.appendChild(caption);
                    


                    modal.appendChild(modalImg);
                    document.body.appendChild(modal);

                    // Animate overlay background
                    setTimeout(() => {
                        modal.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
                    }, 10);

                    // Animate image to center
                    setTimeout(() => {
                        modalImg.style.left = '50%';
                        modalImg.style.top = '20vh';
                        modalImg.style.transform = 'translate(-50%, 0%)';
                        modalImg.style.width = 'auto';
                        modalImg.style.height = '60vh';
                    }, 10);

                    // Remove modal on click (with reverse animation)
                    modal.addEventListener('click', function() {
                        modal.style.backgroundColor = 'rgba(0, 0, 0, 0)';
                        modalImg.style.opacity = '0';
                        setTimeout(() => {
                            if (modal.parentNode) document.body.removeChild(modal);
                        }, 400);
                    });
                });
            });
            


        });
    </script>
</body>
</html>